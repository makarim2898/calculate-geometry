<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hexagon Toolpath Generator</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    canvas { border: 1px solid #ccc; margin-top: 10px; }
    textarea { width: 100%; height: 120px; margin-top: 10px; font-family: monospace; }
    label { display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 5px; margin-top: 5px; }
    button { margin-top: 10px; padding: 10px 20px; }
  </style>
</head>
<body>
  <h2>Hexagon Toolpath Generator (NC)</h2><label>Flat to Flat (mm): <input type="number" id="flat" step="0.01"> </label> <label>Tool Diameter (mm): <input type="number" id="tool" step="0.01"> </label> <label>Jenis Kepala Baut: <select id="type"> <option value="hex">Kunci Pas (Hex Bolt)</option> <option value="socket">Kunci L (Socket Bolt)</option> </select> </label> <button onclick="generate()">Generate</button> <button onclick="downloadGCode()">Export G-code (.gcode)</button>

<canvas id="preview" width="300" height="300"></canvas>

  <h3>Koordinat Asli (X, Y) — Center Toolpath</h3>
  <textarea id="coords" readonly></textarea>  <h3>G-Code (tanpa Z) — Sudah Di-offset</h3>
  <textarea id="gcode" readonly></textarea>  <script>
    let gcodeText = '';

    function generate() {
      const flat = parseFloat(document.getElementById('flat').value);
      const tool = parseFloat(document.getElementById('tool').value);
      const type = document.getElementById('type').value;

      if (!flat || !tool) return alert('Semua input wajib diisi!');

      const canvas = document.getElementById('preview');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const cx = canvas.width / 2;
      const cy = canvas.height / 2;

      // Hitung radius berdasarkan flat to flat
      const baseRadius = flat / (2 * Math.sin(Math.PI / 6));

      // Offset berdasarkan jenis kepala baut
      const offset = (type === 'hex') ? tool / 2 : -tool / 2;
      const centerRadius = baseRadius + offset;

      const coords = [];
      for (let i = 0; i < 6; i++) {
        const angle = Math.PI / 6 + i * Math.PI / 3;
        const x = +(centerRadius * Math.cos(angle)).toFixed(4);
        const y = +(centerRadius * Math.sin(angle)).toFixed(4);
        coords.push({ x, y });
      }

      coords.push(coords[0]); // tutup path

      // Gambar toolpath
      ctx.beginPath();
      ctx.strokeStyle = '#000';
      coords.forEach((p, i) => {
        const scale = 1.2;
        const x = cx + p.x * scale;
        const y = cy - p.y * scale;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.stroke();

      // Output koordinat asli (center path)
      const coordText = coords.map(p => `X${p.x} Y${p.y}`).join("\n");
      document.getElementById('coords').value = coordText;

      // Output G-code (sama dengan koordinat asli, dianggap sudah offset)
      gcodeText = coords.map(p => `G01 X${p.x} Y${p.y}`).join("\n");
      document.getElementById('gcode').value = gcodeText;
    }

    function downloadGCode() {
      if (!gcodeText) return alert('Silakan generate terlebih dahulu.');
      const blob = new Blob([gcodeText], { type: 'text/plain' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'toolpath.gcode';
      link.click();
    }
  </script></body>
</html>
